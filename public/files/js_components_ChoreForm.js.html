<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>js/components/ChoreForm.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/Apartment.html">Apartment</a></li>
                                <li><a href="../classes/Chore.html">Chore</a></li>
                                <li><a href="../classes/DBManager.html">DBManager</a></li>
                                <li><a href="../classes/Message.html">Message</a></li>
                                <li><a href="../classes/Payment.html">Payment</a></li>
                                <li><a href="../classes/React.Component.AddAptDialog.html">React.Component.AddAptDialog</a></li>
                                <li><a href="../classes/React.Component.App.Main.html">React.Component.App.Main</a></li>
                                <li><a href="../classes/React.Component.AuthPage.html">React.Component.AuthPage</a></li>
                                <li><a href="../classes/React.Component.Balance.html">React.Component.Balance</a></li>
                                <li><a href="../classes/React.Component.ChoreCard.html">React.Component.ChoreCard</a></li>
                                <li><a href="../classes/React.Component.ChoreCardGrid.html">React.Component.ChoreCardGrid</a></li>
                                <li><a href="../classes/React.Component.ChoreCardRow.html">React.Component.ChoreCardRow</a></li>
                                <li><a href="../classes/React.Component.ChoreForm.html">React.Component.ChoreForm</a></li>
                                <li><a href="../classes/React.Component.ChoreRow.html">React.Component.ChoreRow</a></li>
                                <li><a href="../classes/React.Component.Chores.html">React.Component.Chores</a></li>
                                <li><a href="../classes/React.Component.ChoresView.html">React.Component.ChoresView</a></li>
                                <li><a href="../classes/React.Component.ChoreTable.html">React.Component.ChoreTable</a></li>
                                <li><a href="../classes/React.Component.CredentialCard.html">React.Component.CredentialCard</a></li>
                                <li><a href="../classes/React.Component.FAB.html">React.Component.FAB</a></li>
                                <li><a href="../classes/React.Component.FloatingCard.html">React.Component.FloatingCard</a></li>
                                <li><a href="../classes/React.Component.FloatingDialog.html">React.Component.FloatingDialog</a></li>
                                <li><a href="../classes/React.Component.HomePage.html">React.Component.HomePage</a></li>
                                <li><a href="../classes/React.Component.Loading.html">React.Component.Loading</a></li>
                                <li><a href="../classes/React.Component.LoginForm.html">React.Component.LoginForm</a></li>
                                <li><a href="../classes/React.Component.Messages.html">React.Component.Messages</a></li>
                                <li><a href="../classes/React.Component.Messagesable.html">React.Component.Messagesable</a></li>
                                <li><a href="../classes/React.Component.MessagesCard.html">React.Component.MessagesCard</a></li>
                                <li><a href="../classes/React.Component.MessagesEditor.html">React.Component.MessagesEditor</a></li>
                                <li><a href="../classes/React.Component.MessagesView.html">React.Component.MessagesView</a></li>
                                <li><a href="../classes/React.Component.NavBar.html">React.Component.NavBar</a></li>
                                <li><a href="../classes/React.Component.NavDrawer.html">React.Component.NavDrawer</a></li>
                                <li><a href="../classes/React.Component.NavLinks.html">React.Component.NavLinks</a></li>
                                <li><a href="../classes/React.Component.PaymentForm.html">React.Component.PaymentForm</a></li>
                                <li><a href="../classes/React.Component.PaymentsCard.html">React.Component.PaymentsCard</a></li>
                                <li><a href="../classes/React.Component.PaymentsComponent.html">React.Component.PaymentsComponent</a></li>
                                <li><a href="../classes/React.Component.PaymentsList.html">React.Component.PaymentsList</a></li>
                                <li><a href="../classes/React.Component.PaymentsTable.html">React.Component.PaymentsTable</a></li>
                                <li><a href="../classes/React.Component.PaymentsView.html">React.Component.PaymentsView</a></li>
                                <li><a href="../classes/React.Component.SettingsView.html">React.Component.SettingsView</a></li>
                                <li><a href="../classes/React.Component.SignUpForm.html">React.Component.SignUpForm</a></li>
                                <li><a href="../classes/React.Component.SummaryInfo.html">React.Component.SummaryInfo</a></li>
                                <li><a href="../classes/React.Component.TodoItem.html">React.Component.TodoItem</a></li>
                                <li><a href="../classes/React.Component.TodoList.html">React.Component.TodoList</a></li>
                                <li><a href="../classes/React.Component.ToggleButton.html">React.Component.ToggleButton</a></li>
                                <li><a href="../classes/React.Component.Transaction.html">React.Component.Transaction</a></li>
                                <li><a href="../classes/User.html">User</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: js/components/ChoreForm.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
import React from &#x27;react&#x27;;
import User from &#x27;../User.js&#x27;;
import Chore from &#x27;../Chore.js&#x27;;
import ReactDOM from &#x27;react-dom&#x27;;
import Formsy from &#x27;formsy-react&#x27;;
import Apartment from &#x27;../Apartment.js&#x27;;
import DBManager from &#x27;../dbManager.js&#x27;;
import Divider from &#x27;material-ui/Divider&#x27;;
import MenuItem from &#x27;material-ui/MenuItem&#x27;;
import RaisedButton from &#x27;material-ui/RaisedButton&#x27;;
import {FormsyText, FormsyDate, FormsySelect} from &#x27;formsy-material-ui/lib&#x27;;
import {Card, CardActions, CardHeader, CardMedia, CardTitle, CardText} from &#x27;material-ui/Card&#x27;;



const style = {
  chorebox: {
    width:256,
    minHeight:384,
    textAlign:&#x27;center&#x27;,
    padding:&#x27;12px&#x27;,
  },
  messagebody: {
    minHeight:&#x27;80px&#x27;,
    borderRadius: &#x27;6px&#x27;,
    padding:&#x27;6px&#x27;,
    backgroundColor:&#x27;rgba(135,125,102,0.1)&#x27;,
    border:&#x27;2px solid rgba(224, 224, 224,0.8)&#x27;,
  },
};
/**
 * Represents a Chore Form.
 *
 * @class React.Component.ChoreForm
 * @extends React.Component
 */
export default class ChoreForm extends React.Component {
    /**
     * Constructs a Chore Form.
     *
     * @method constructor
     * @constructor
     * @param {Object} props - Properties passed by parent. See propTypes
     */
    constructor(props) {
        super(props);

        this.errorMessages = {
            wordsError: &quot;Please only use letters&quot;,
            numericError: &quot;Please provide a number&quot;
        };

        this.state = {
            tenants: []
        };

        this.setTenantsList = this.setTenantsList.bind(this);
        this.enableSubmit = this.enableSubmit.bind(this);
        this.disableSubmit = this.disableSubmit.bind(this);
        this.handleSubmit = this.handleSubmit.bind(this);
        this.handleInvalidSubmit = this.handleInvalidSubmit.bind(this);
        this.loopAddChores = this.loopAddChores.bind(this);
        this.addChore = this.addChore.bind(this);

        this.choreIterator = 0;
    }

    /**
     * Function called when component mounts.
     *
     * @method componentDidMount
     */
    componentDidMount() {
        this.setTenantsList();
    }

    /**
     * Sets the tenants list in state.
     *
     * @method setTenantsList
     */
    setTenantsList() {
        var manager = new DBManager();
        var tenants = [];
        manager.getApartment().then(function(apartment) {
            var tenantIDs = apartment.getTenantIDs();
            tenantIDs.forEach(function(tenantID) {
                manager.getUser(tenantID).then(function(user) {
                    tenants.push(user);
                    this.setState({tenants: tenants});
                }.bind(this));
            }.bind(this));
        }.bind(this));
    }

    /**
     * Enables form submission.
     *
     * @method enableSubmit
     */
    enableSubmit() {
        this.setState({
            canSubmit: true
        });
    }

    /**
     * Disables form submission.
     *
     * @method disableSubmit
     */
    disableSubmit() {
        this.setState({
            canSubmit: false
        });
    }

    /**
     * Validates data submitted through the form.
     *
     * @method validateData
     * @param {Obj} data - The form data
     * @return {boolean} - Whether form is valid or not
     */
    validateData(data) {
        console.log(&quot;data: &quot;,data);
        var yesterday = new Date();
        yesterday.setDate(yesterday.getDate() - 1);
        if (yesterday &gt;= data.choreFirstDueDate) {
            console.log(&#x27;Cannot assign chores due in the past&#x27;);
            return false;
        }
        var repeatFrequency = parseInt(data.choreRepeatFreqency);
        if (repeatFrequency &lt; 1 || repeatFrequency &gt; 365) {
            console.log(&#x27;Repeat frequency must be between 1 and 365, inclusive&#x27;);
            return false;
        }
        var numberOccurrences = parseInt(data.choreNumberOccurrences);
        if (numberOccurrences &lt; 1 || numberOccurrences &gt; 100) {
            console.log(&#x27;Number of occurrences must be between 1 and 100, inclusive&#x27;);
            return false;
        }
        return true;
    }

    /**
     * Loops through chores and adds them to database.
     * Uses callbacks to avoid using stale caches.
     *
     * @method loopAddChores
     * @param {Array[Chore]} chores - Chores to be added
     */
    loopAddChores(chores) {
        this.addChore(chores[this.choreIterator], function() {
            this.choreIterator += 1;

            if (this.choreIterator &lt; chores.length) {
                this.loopAddChores(chores);
            }
        }.bind(this));
    }

    /**
     * Adds a chore to the database and calls the callback
     * function after successfully adding it.
     *
     * @method addChore
     * @param {Chore} newChore - The chore to be added
     * @param {function} callback - The callback function
     */
    addChore(newChore, callback) {
        var manager = new DBManager();
        manager.addChore(newChore, callback);
    }

    /**
     * Handles when Chore Form is submitted by pushing the
     * desired Chore(s) to the database.
     *
     * @method handleSubmit
     * @param {Object} data - Chore data to be added to database
     */
    handleSubmit(data) {
        this.choreIterator = 0;

        if (this.validateData(data)) {
            console.log(&quot;submitting chore&quot;);
            console.log(data);

            var name = data.choreName;
            var assignee = data.choreAssignee;
            var category = data.choreCategory;
            var firstDueDate = data.choreFirstDueDate;
            var numberOccurrences = parseInt(data.choreNumberOccurrences);
            var repeatFrequency = parseInt(data.choreRepeatFrequency);
            var details = data.choreDetails;

            var manager = new DBManager();
            var aptID = manager.getApartment().then(function (apt) {
                return apt.getAptID();
            });
            var UID = manager.getUser().then(function (user) {
                return user.getUserID()
            });
            Promise.all([UID, aptID]).then(values =&gt; {
                var newChores = [];
                do {
                    var assignedDueDate = new Date();
                    assignedDueDate.setFullYear(firstDueDate.getFullYear());
                    assignedDueDate.setMonth(firstDueDate.getMonth());
                    assignedDueDate.setDate(firstDueDate.getDate() + (newChores.length * repeatFrequency));
                    var newChore = new Chore(values[0], values[1], name, category, assignedDueDate, details, assignee);
                    newChores.push(newChore);
                    console.log(newChore);
                } while (newChores.length &lt; numberOccurrences);
                this.loopAddChores(newChores);
            });
        }
    }

    /**
     * Handles invalid form submission.
     *
     * @method handleInvalidSubmit
     * @param {Object} data - The invalid data submitted
     */
    handleInvalidSubmit(data) {
        console.error(&quot;Received invalid submit: &quot;, data);
    }

    /**
     * Renders a Chore Form.
     *
     * @method render
     */
    render() {
          return (
              &lt;div style={style.chorebox}&gt;
              &lt;CardTitle title=&quot;Assign a Chore&quot; /&gt;
              &lt;Divider /&gt;
                  &lt;Formsy.Form ref=&quot;addChores&quot;
                      onValid={this.enableSubmit}
                      onInvalid={this.disableSubmit}
                      onValidSubmit={this.handleSubmit}
                      onInvalidSubmit={this.handleInvalidSubmit} &gt;
                      &lt;FormsyText
                          name=&quot;choreName&quot;
                          floatingLabelText=&quot;Chore Name&quot;
                          fullWidth={true}
                          validations=&quot;isWords&quot;
                          validationError={this.errorMessages.wordsError}
                          required={true} /&gt;
                      &lt;FormsyText
                          name=&quot;choreCategory&quot;
                          floatingLabelText=&quot;Category Labels&quot;
                          fullWidth={true}
                          validations=&quot;isWords&quot;
                          validationError={this.errorMessages.wordsError}
                          required={true} /&gt;
                          &lt;FormsySelect
                              name=&quot;choreAssignee&quot;
                              floatingLabelText=&quot;Assignee&quot;
                              fullWidth={true}
                              required={true}
                          &gt;
                              {this.state.tenants.map(function(tenant) {return (&lt;MenuItem value={tenant.getUserID()} primaryText={tenant.getName()}/&gt;);})}
                          &lt;/FormsySelect&gt;
                      &lt;FormsyDate
                          name=&quot;choreFirstDueDate&quot;
                          floatingLabelText=&quot;Due Date&quot;
                          required={true} /&gt;
                      &lt;FormsyText
                          name=&quot;choreNumberOccurrences&quot;
                          floatingLabelText=&quot;Number of Occurrences&quot;
                          validations=&quot;isNumeric&quot;
                          fullWidth={true}
                          validationError={this.errorMessages.numericError}
                          required={true} /&gt;
                      &lt;FormsyText
                          name=&quot;choreRepeatFrequency&quot;
                          validations=&quot;isNumeric&quot;
                          floatingLabelText=&quot;Repeat Frequency (in Days)&quot;
                          fullWidth={true}
                          validationError={this.errorMessages.numericError}
                          required={true} /&gt;
                      &lt;FormsyText
                          hintText=&quot;Additional Details&quot;
                          multiLine={true}
                          fullWidth={true}
                          rows={1}
                          textareaStyle={style.messagebody}
                          name=&quot;choreDetails&quot; /&gt;
                    &lt;CardActions&gt;
                      &lt;RaisedButton fullWidth={true}
                          type=&quot;submit&quot;
                          label=&quot;Send chores&quot;
                          primary={false}
                          secondary={true} /&gt;
                    &lt;/CardActions&gt;
                  &lt;/Formsy.Form&gt;
              &lt;/div&gt;
          );
    }
}

          // var _label = this.state.sending ? &quot;Sending...&quot; : this.state.sent ? &quot;Sent!&quot; : &quot;Send Message&quot;;
          // &lt;Formsy.Form ref=&quot;addMessage&quot; onValidSubmit={this.addItem} &gt;
          //   &lt;CardText&gt;
          //     &lt;FormsyText required={true} fullWidth={true} name=&quot;messageText&quot; hintText={&quot;Type message here&quot;} multiLine={true} rows={1} textareaStyle={style.messagebody} underlineDisabledStyle={null} errorText=&quot;Message Field cannot be empty&quot;/&gt;
          //   &lt;/CardText&gt;
          //   &lt;CardActions&gt;
          //   &lt;RaisedButton fullWidth={true} type=&quot;submit&quot; label={_label} primary={false} secondary={true} disabled={this.state.sent}/&gt;
          //   &lt;/CardActions&gt;
          // &lt;/Formsy.Form&gt;

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
